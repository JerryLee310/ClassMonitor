# 智能监控系统 - 功能说明

## 主要功能

### 1. 视频录制
- 实时摄像头输入显示
- 支持开始/停止录制
- 录制的视频自动保存为加密格式
- 时间戳可位置可调（左上、右上、左下、右下）
- 实时视频窗口不显示时间戳，录制的视频会包含时间戳

### 2. 加密存储
- 所有录制视频自动采用 Fernet 加密存储
- 加密密钥自动生成并隐藏
- 加密文件存储在 `.recordings` 隐藏目录中
- 视频文件保存格式：`.avi.encrypted`

### 3. 密码保护
- 程序退出需要输入密码
- 删除视频需要输入密码
- 密码固定为：`naxidatianxiadiyikeai1027`（不可更改）
- 密码通过 SHA256 哈希验证

### 4. 视频管理
- **导出视频**：选择加密视频，导出到桌面为正常 AVI 格式
- **删除视频**：需要密码验证后删除选中视频
- **视频目录**：打开隐藏的视频存储目录
- **自动删除**：超过 7 天的视频自动删除

### 5. 公告系统
- 添加公告：输入文本和时间戳
- 公告朗读：使用 TTS 朗读最新公告（支持中文）
- 清空公告：删除所有公告
- 公告持久化存储在 config.json

### 6. 悬浮窗
- 全局悬浮录制器窗口
- 录制时为红色，其他时间为灰色
- 支持拖动位置
- 按钮功能：
  - **打开**：打开主窗口
  - **录制**：开始/停止录制
  - **笔**：屏幕笔（预留功能）

### 7. 系统托盘
- 托盘图标显示程序状态
- 右键菜单支持快速操作
- 双击托盘图标打开主窗口

### 8. UI 设计
- 基于 Microsoft Fluent Design 原则
- 中文简体界面
- 顶部显示日期/时间
- 左侧公告栏，右下角视频窗口
- 流畅的动画和过渡效果

## 快速开始

### 运行程序
```bash
python3 monitoring_app.py
```

或使用 Windows 版本（支持权限提升）：
```bash
python3 run.py
```

### 基本操作流程

1. 启动程序
2. 点击"启动摄像头"按钮
3. 调整曝光度和时间戳位置
4. 点击"开始录制"进行录制
5. 点击"停止录制"停止录制（视频自动加密保存）
6. 通过菜单导出、删除或查看视频

## 设置说明

### 曝光调整
- 范围：-10 到 10
- 用于调整视频亮度

### 时间位置
- 左上角、右上角、左下角、右下角
- 仅在录制时在视频中显示时间戳

## 文件结构

```
.
├── monitoring_app.py       # 主应用程序
├── windows_admin.py        # Windows 管理工具
├── run.py                  # Windows 启动脚本
├── config.json             # 配置文件（自动生成）
├── .key                    # 加密密钥（隐藏）
├── .recordings/            # 录制视频目录（隐藏）
└── requirements.txt        # 依赖包
```

## 密钥信息

### 密码
- **密码**：`naxidatianxiadiyikeai1027`
- **用途**：退出程序、删除视频、管理文件
- **验证方式**：SHA256 哈希

### 加密
- **算法**：Fernet（对称加密）
- **密钥存储**：`.key` 文件（自动隐藏）

## 依赖项

- opencv-python >= 4.8.0
- numpy >= 1.24.0
- Pillow >= 10.0.0
- PyQt5 >= 5.15.0
- PyQt-Fluent-Widgets >= 1.5.0
- cryptography >= 41.0.0
- pyttsx3 >= 2.90

## 系统要求

- Python 3.8 或更高版本
- Windows、macOS 或 Linux
- 可用的摄像头设备

## 故障排除

### 无法打开摄像头
- 检查摄像头是否被占用
- 确保有摄像头设备连接
- 重试启动

### TTS 不工作
- 确保系统安装了 TTS 引擎
- 对于 Linux，可能需要安装 `espeak`：`sudo apt-get install espeak`

### 无法导出视频
- 确保桌面目录存在且可写
- 检查磁盘空间是否充足

## 许可证

见 LICENSE 文件

## 安全提示

1. 妥善保管密码
2. 定期备份重要视频
3. 不要删除 `.key` 文件，否则无法解密视频
4. 定期检查视频存储空间
